# Docker Compose - Slave1 ECS 节点配置
# 在从服务器1上运行，包含hadoop2

version: '3.8'

services:
  hadoop2:
    image: hadoop-ecosystem:latest
    container_name: hadoop2
    hostname: hadoop2
    privileged: true
    networks:
      hadoop-net:
        ipv4_address: 172.18.0.3
    ports:
      # SSH
      - "2202:22"
      # DataNode
      - "9864:9864"
      # NodeManager
      - "8042:8042"
      # ZooKeeper
      - "2181:2181"
      # HBase RegionServer
      - "16020:16020"
      - "16030:16030"
    environment:
      - NODE_ROLE=slave
      - NODE_ID=2
    volumes:
      # 持久化数据
      - hadoop2-data:/data
      # 配置文件
      - ../../../config/hadoop:/usr/local/hadoop/etc/hadoop
      - ../../../config/zookeeper/zoo.cfg:/usr/local/zookeeper/conf/zoo.cfg
      - ../../../config/hbase:/usr/local/hbase/conf
    extra_hosts:
      - "hadoop1:${MASTER_IP:-172.18.0.2}"
      - "hadoop2:172.18.0.3"
      - "hadoop3:${SLAVE2_IP:-172.18.0.4}"
    restart: unless-stopped

networks:
  hadoop-net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.18.0.0/24

volumes:
  hadoop2-data:

